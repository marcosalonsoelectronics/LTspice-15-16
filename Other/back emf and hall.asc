Version 4
SHEET 1 3836 1812
WIRE -208 -288 -224 -288
WIRE -160 -288 -208 -288
WIRE 160 -288 48 -288
WIRE 192 -288 160 -288
WIRE -208 -240 -224 -240
WIRE -160 -240 -208 -240
WIRE 160 -240 48 -240
WIRE 192 -240 160 -240
WIRE -208 -192 -224 -192
WIRE -160 -192 -208 -192
WIRE 160 -192 48 -192
WIRE 192 -192 160 -192
WIRE -208 -144 -224 -144
WIRE -160 -144 -208 -144
WIRE -400 -80 -528 -80
WIRE -288 -80 -400 -80
WIRE -528 -48 -528 -80
WIRE -288 16 -288 -80
WIRE -16 16 -16 -112
WIRE -16 16 -288 16
WIRE 480 32 384 32
WIRE 720 32 560 32
WIRE -528 64 -528 32
WIRE -400 112 -528 112
WIRE -96 112 -96 -112
WIRE -96 112 -400 112
WIRE -528 160 -528 112
WIRE 384 208 384 32
WIRE 400 208 384 208
WIRE 480 208 400 208
WIRE 720 208 560 208
WIRE -528 288 -528 240
WIRE 384 384 384 208
WIRE 480 384 384 384
WIRE 720 384 560 384
WIRE -288 400 -528 400
WIRE -240 400 -288 400
WIRE -528 464 -528 400
WIRE -528 608 -528 544
WIRE 624 640 400 640
WIRE 800 640 624 640
WIRE 1040 656 864 656
WIRE 1072 656 1040 656
WIRE 1504 656 1280 656
WIRE 1680 656 1504 656
WIRE 800 672 752 672
WIRE 1872 672 1744 672
WIRE 1904 672 1872 672
WIRE 400 688 400 640
WIRE 1680 688 1648 688
WIRE -304 704 -544 704
WIRE -256 704 -304 704
WIRE 752 704 752 672
WIRE 1280 704 1280 656
WIRE 1648 736 1648 688
WIRE -544 768 -544 704
WIRE 400 800 400 768
WIRE 1280 816 1280 784
WIRE 624 880 400 880
WIRE 800 880 624 880
WIRE 1040 896 864 896
WIRE 1072 896 1040 896
WIRE -544 912 -544 848
WIRE 800 912 752 912
WIRE 400 928 400 880
WIRE 752 944 752 912
WIRE 400 1040 400 1008
FLAG -528 288 0
FLAG -528 64 0
FLAG -400 -80 amp
FLAG -400 112 thetat
FLAG -208 -288 ea1
FLAG -208 -240 eb1
FLAG -208 -192 ec1
FLAG 160 -192 hc1
FLAG 160 -240 hb1
FLAG 160 -288 ha1
FLAG 720 32 a
IOPIN 720 32 Out
FLAG 720 384 c
IOPIN 720 384 Out
FLAG 720 208 b
IOPIN 720 208 Out
FLAG 752 704 0
FLAG 400 800 0
FLAG 1040 896 ha
FLAG 624 640 ca
FLAG 1648 736 0
FLAG 1280 816 0
FLAG 1504 656 ab
FLAG 1872 672 hb
FLAG 752 944 0
FLAG 400 1040 0
FLAG 1040 656 hc
FLAG 624 880 bc
FLAG 400 208 N
FLAG -208 -144 n1
FLAG -544 912 0
FLAG -304 704 theta
FLAG -528 608 0
FLAG -288 400 nr
SYMBOL voltage -528 -64 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 1
SYMBOL voltage -528 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 {4*pi} 0 1m 1m 1m 5m)
SYMBOL Misc\\Epoly 576 32 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 61 -1414 VTop 2
SYMATTR InstName Ea
SYMATTR Value value= {if(V(theta)<pi/6, V(amp)*V(theta)/(pi/6),if(V(theta)<5*pi/6, V(amp), if(V(theta)<7*pi/6, V(amp)-V(amp)*(V(theta)-5*pi/6)/(pi/6),  if( V(theta)<11*pi/6, -V(amp),   if(V(theta)<2*pi, -V(amp) + V(amp)*(V(theta)-11*pi/6)/(pi/6),0)    )    )   )  )}
SYMBOL BLDCM\\bemf -112 -240 R0
SYMATTR InstName U1
SYMBOL Misc\\Epoly 576 208 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 50 -1392 VTop 2
SYMATTR InstName Eb
SYMATTR Value value={if(V(theta)<pi/2, -V(amp), if( V(theta)< 5*pi/6, -V(amp)+V(amp)*(V(theta)-3*pi/6)/(pi/6), if( V(theta)<9*pi/6, V(amp), if(V(theta)<11*pi/6, V(amp)-V(amp)*(V(theta)-9*pi/6)/(pi/6), if( V(theta)<2*pi, -V(amp), 0   )    )     )     )                )}
SYMBOL Misc\\Epoly 576 384 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 50 -1392 VTop 2
SYMATTR InstName Ec
SYMATTR Value value={if(V(theta)<pi/6, V(amp), if( V(theta)<3*pi/6, V(amp)-V(amp)*(V(theta)-pi/6)/(pi/6), if(V(theta)<7*pi/6, -V(amp), if(V(theta)<9*pi/6, -V(amp)+V(amp)*(V(theta)-7*pi/6)/(pi/6), if( V(theta)<2*pi, V(amp), 0   )       )      )   )      )  }
SYMBOL Control\\comp 832 656 M180
WINDOW 3 -14 -56 Left 2
WINDOW 123 -10 -86 Left 2
SYMATTR Value Vhigh=5
SYMATTR Value2 Vlow=0
SYMATTR InstName Uha
SYMBOL Misc\\Epoly 400 672 R0
WINDOW 3 53 73 Left 2
SYMATTR Value value={V(c)-V(a)}
SYMATTR InstName Eca
SYMBOL Control\\comp 1712 672 M180
WINDOW 3 7 -52 Left 2
WINDOW 123 15 -82 Left 2
SYMATTR Value Vhigh=5
SYMATTR Value2 Vlow=0
SYMATTR InstName Uhb
SYMBOL Misc\\Epoly 1280 688 R0
WINDOW 3 53 73 Left 2
SYMATTR Value value={V(a)-V(b)}
SYMATTR InstName Eca1
SYMBOL Control\\comp 832 896 R0
WINDOW 3 -24 46 Left 2
WINDOW 123 -21 71 Left 2
SYMATTR Value Vhigh=5
SYMATTR Value2 Vlow=0
SYMATTR InstName Uhc
SYMBOL Misc\\Epoly 400 912 R0
WINDOW 3 53 73 Left 2
SYMATTR Value value={V(b)-V(c)}
SYMATTR InstName Ebc
SYMBOL Misc\\Epoly -544 752 R0
SYMATTR InstName E3
SYMATTR Value value={ ( V(thetat)/(2*pi) -V(nr) )*2*pi}
SYMBOL Misc\\Epoly -528 448 R0
SYMATTR InstName E1
SYMATTR Value value={ floor( V(thetat)/(2*pi) )}
TEXT 440 -176 Left 2 !.tran 0 1m 0
TEXT 104 208 Left 2 ;Do not connect to 0V
TEXT -328 424 Left 2 ;number of revolutions
TEXT -360 728 Left 2 ;angle in 0-2*pi
